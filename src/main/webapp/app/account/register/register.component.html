<div class="mt-3">
  <div class="d-flex justify-content-center">
    <div class="col-md-8 col-lg-6 col-xl-5">
      <center><h1 data-cy="registerTitle">Registration</h1></center>
    </div>
  </div>

  <div class="d-flex justify-content-center">
    <div class="col-md-8 col-lg-6 col-xl-6">
      <div class="card">
        <div class="card-body p-5">
          <div class="p-3">
            @if (!success()) {
              <form name="form" (ngSubmit)="register()" [formGroup]="registerForm">
                <div class="mb-3">
                  <label class="form-label" for="login">Username</label>

                  <div class="input-group">
                    <span class="input-group-text">
                      <fa-icon icon="user"></fa-icon>
                    </span>
                    <input
                      type="text"
                      class="form-control"
                      id="login"
                      name="login"
                      placeholder="Your username"
                      formControlName="login"
                      data-cy="username"
                      #login
                    />
                  </div>
                  @let loginRef = registerForm.get('login')!;
                  @if (loginRef.invalid && (loginRef.dirty || loginRef.touched)) {
                    <div>
                      @if (loginRef?.errors?.required) {
                        <small class="form-text text-danger">Your username is required.</small>
                      }

                      @if (loginRef?.errors?.minlength) {
                        <small class="form-text text-danger">Your username is required to be at least 3 character.</small>
                      }

                      @if (loginRef?.errors?.maxlength) {
                        <small class="form-text text-danger">Your username cannot be longer than 50 characters.</small>
                      }

                      @if (loginRef?.errors?.pattern) {
                        <small class="form-text text-danger">Your username is invalid.</small>
                      }
                    </div>
                  }
                </div>

                <div class="mb-3">
                  <label class="form-label">FirstName</label>

                  <div class="input-group">
                    <span class="input-group-text">
                      <fa-icon icon="user"></fa-icon>
                    </span>
                    <input
                      type="text"
                      class="form-control"
                      id="firstname"
                      name="firstname"
                      placeholder="Your firstname"
                      formControlName="firstname"
                      data-cy="firstname"
                      #firstname
                    />
                  </div>
                  @let firstnameRef = registerForm.get('firstname')!;
                  @if (firstnameRef.invalid && (firstnameRef.dirty || firstnameRef.touched)) {
                    <div>
                      @if (firstnameRef?.errors?.required) {
                        <small class="form-text text-danger">Your firstname is required.</small>
                      }

                      @if (firstnameRef?.errors?.minlength) {
                        <small class="form-text text-danger">Your firstname is required to be at least 2 character.</small>
                      }

                      @if (firstnameRef?.errors?.maxlength) {
                        <small class="form-text text-danger">Your firstname cannot be longer than 256 characters.</small>
                      }
                    </div>
                  }
                </div>

                <div class="mb-3">
                  <label class="form-label">LastName</label>

                  <div class="input-group">
                    <span class="input-group-text">
                      <fa-icon icon="user"></fa-icon>
                    </span>
                    <input
                      type="text"
                      class="form-control"
                      id="lastname"
                      name="lastname"
                      placeholder="Your lastname"
                      formControlName="lastname"
                      data-cy="lastname"
                      #lastname
                    />
                  </div>
                  @let lastnameRef = registerForm.get('lastname')!;
                  @if (lastnameRef.invalid && (lastnameRef.dirty || lastnameRef.touched)) {
                    <div>
                      @if (lastnameRef?.errors?.required) {
                        <small class="form-text text-danger">Your lastname is required.</small>
                      }

                      @if (lastnameRef?.errors?.minlength) {
                        <small class="form-text text-danger">Your lastname is required to be at least 2 character.</small>
                      }

                      @if (lastnameRef?.errors?.maxlength) {
                        <small class="form-text text-danger">Your lastname cannot be longer than 256 characters.</small>
                      }
                    </div>
                  }
                </div>

                <div class="mb-3">
                  <label class="form-label" for="email">Email</label>

                  <div class="input-group">
                    <span class="input-group-text">
                      <fa-icon icon="envelope"></fa-icon>
                    </span>
                    <input
                      type="text"
                      class="form-control"
                      id="email"
                      name="email"
                      placeholder="Your email"
                      formControlName="email"
                      data-cy="email"
                    />
                  </div>
                  @let emailRef = registerForm.get('email')!;
                  @if (emailRef.invalid && (emailRef.dirty || emailRef.touched)) {
                    <div>
                      @if (emailRef?.errors?.required) {
                        <small class="form-text text-danger">Your email is required.</small>
                      }

                      @if (emailRef?.errors?.invalid) {
                        <small class="form-text text-danger">Your email is invalid.</small>
                      }

                      @if (emailRef?.errors?.minlength) {
                        <small class="form-text text-danger">Your email is required to be at least 5 characters.</small>
                      }

                      @if (emailRef?.errors?.maxlength) {
                        <small class="form-text text-danger">Your email cannot be longer than 50 characters.</small>
                      }
                    </div>
                  }
                </div>

                <div class="mb-3">
                  <label class="form-label" for="password">Password</label>

                  <div class="input-group">
                    <span class="input-group-text">
                      <fa-icon icon="lock"></fa-icon>
                    </span>
                    <input
                      type="password"
                      class="form-control"
                      id="password"
                      name="password"
                      placeholder="New password"
                      formControlName="password"
                      data-cy="email"
                    />
                  </div>

                  @let passwordRef = registerForm.get('password')!;
                  @if (passwordRef.invalid && (passwordRef.dirty || passwordRef.touched)) {
                    <div>
                      @if (passwordRef?.errors?.required) {
                        <small class="form-text text-danger">Your password is required.</small>
                      }

                      @if (passwordRef?.errors?.minlength) {
                        <small class="form-text text-danger">Your password is required to be at least 4 characters.</small>
                      }

                      @if (passwordRef?.errors?.maxlength) {
                        <small class="form-text text-danger">Your password cannot be longer than 100 characters.</small>
                      }
                    </div>
                  }

                  <jhi-password-strength-bar [passwordToCheck]="passwordRef.value"></jhi-password-strength-bar>
                </div>

                <div class="mb-3">
                  <label class="form-label" for="confirmPassword">New password confirmation</label>

                  <div class="input-group">
                    <span class="input-group-text">
                      <fa-icon icon="lock"></fa-icon>
                    </span>
                    <input
                      type="password"
                      class="form-control"
                      id="confirmPassword"
                      name="confirmPassword"
                      placeholder="Confirm the new password"
                      formControlName="confirmPassword"
                      data-cy="secondPassword"
                    />
                  </div>

                  @let confirmPasswordRef = registerForm.get('confirmPassword')!;
                  @if (confirmPasswordRef.invalid && (confirmPasswordRef.dirty || confirmPasswordRef.touched)) {
                    <div>
                      @if (confirmPasswordRef?.errors?.required) {
                        <small class="form-text text-danger">Your confirmation password is required.</small>
                      }

                      @if (confirmPasswordRef?.errors?.minlength) {
                        <small class="form-text text-danger">Your confirmation password is required to be at least 4 characters.</small>
                      }

                      @if (confirmPasswordRef?.errors?.maxlength) {
                        <small class="form-text text-danger">Your confirmation password cannot be longer than 100 characters.</small>
                      }
                      @if (registerForm.errors?.['passwordMismatch'] && confirmPasswordRef.dirty) {
                        <br /><small class="form-text text-danger"> Passwords do not match.</small>
                      }
                    </div>
                  }
                </div>

                <div class="mb-3">
                  <label class="form-label" for="image">Profile picture</label>

                  <div class="d-flex flex-column justify-content-center">
                    <div class="d-flex flex-row justify-content-center align-items-start">
                      <div>
                        <img class="rounded-circle avatar mb-3" [ngClass]="{ 'default-image': true }" [src]="imageUrl()" />
                      </div>

                      @if (imageUrl()) {
                        <div>
                          <fa-icon icon="xmark" (click)="removeProfileImage()"></fa-icon>
                        </div>
                      }
                    </div>
                    <div class="d-flex justify-content-center">
                      <input type="file" class="form-control w-50" #imageRef (change)="onFileChange($event)" accept="image/*" />
                    </div>
                  </div>
                </div>

                <button type="submit" [disabled]="registerForm.invalid" class="btn btn-primary w-100 mb-2" data-cy="submit">
                  Register
                </button>
              </form>
            }

            @if (success()) {
              <div class="alert alert-success"><strong>Registration saved!</strong> Please check your email for confirmation.</div>
            }

            @if (error()) {
              <div class="alert alert-danger"><strong>Registration failed!</strong> Please try again later.</div>
            }

            @if (errorUserExists()) {
              <div class="alert alert-danger"><strong>Login name already registered!</strong> Please choose another one.</div>
            }

            @if (errorEmailExists()) {
              <div class="alert alert-danger"><strong>Email is already in use!</strong> Please choose another one.</div>
            }

            @if (doNotMatch()) {
              <div class="alert alert-danger">The password and its confirmation do not match!</div>
            }

            <div class="mt-3 alert alert-warning">
              <span>If you want to </span>
              <a class="alert-link" routerLink="/login">sign in</a
              ><span
                >, you can try the default accounts:<br />- Administrator (login=&quot;admin&quot; and password=&quot;admin&quot;) <br />-
                User (login=&quot;user&quot; and password=&quot;user&quot;).</span
              >
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
